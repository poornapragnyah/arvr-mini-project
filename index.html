<html>
    <head>
        <link href="https://cdn.osmbuildings.org/4.0.0/OSMBuildings.css" rel="stylesheet">
        <script src="https://cdn.osmbuildings.org/4.0.0/OSMBuildings.js"></script>
    </head>
    <body>
        <div id="map" style="width: 100vw; height: 100vh;"></div>

        <script src="https://rawgit.com/OSMBuildings/OSMBuildings/master/dist/OSMBuildings/OSMBuildings.js"></script> 
        
        <script>
            var map = new OSMBuildings({
                container: 'map',
                position: { latitude: 12.96964725952364, longitude: 77.58337244021612 }, // Starting position
                zoom: 16,
                minZoom: 15,
                maxZoom: 20,
                tilt: 40, 
                rotation: 300,
                effects: ['shadows'],
                attribution: '© Data <a href="https://openstreetmap.org/copyright/">OpenStreetMap</a> © Map <a href="https://mapbox.com/">Mapbox</a> © 3D <a href="https://osmbuildings.org/copyright/">OSM Buildings</a>'
            });

            map.addMapTiles('https://tile-a.openstreetmap.fr/hot/{z}/{x}/{y}.png');
            map.addGeoJSONTiles('https://{s}.data.osmbuildings.org/0.2/59fcc2e8/tile/{z}/{x}/{y}.json');

            let position = { latitude: 12.96964725952364, longitude:77.58337244021612 }; // Store current position
            let movementSpeed = 0.0000005; // Movement speed for smooth transition
            let rotationSpeed = 0.1; // Rotation speed for smooth transition
            let zoomSpeed = 0.005; // Zoom speed for smooth transition
            let tiltSpeed = 1; // Tilt speed for smooth transition

            let isMoving = false; // To control if movement is happening
            let currentMovement = null; // Store current movement type

            function smoothTransition() {
                if (!isMoving) return;
                
                switch (currentMovement) {
                    case 'moveNorth':
                        position.latitude += movementSpeed;
                        break;
                    case 'moveSouth':
                        position.latitude -= movementSpeed;
                        break;
                    case 'moveWest':
                        position.longitude -= movementSpeed;
                        break;
                    case 'moveEast':
                        position.longitude += movementSpeed;
                        break;
                    case 'rotateLeft':
                        map.setRotation(map.getRotation() - rotationSpeed);
                        break;
                    case 'rotateRight':
                        map.setRotation(map.getRotation() + rotationSpeed);
                        break;
                    case 'zoomIn':
                        map.setZoom(map.getZoom() + zoomSpeed);
                        break;
                    case 'zoomOut':
                        map.setZoom(map.getZoom() - zoomSpeed);
                        break;
                    // case 'tilt':
                    //     let newTilt = map.getTilt() + tiltSpeed;
                    //     if (newTilt > 40) newTilt = 0; // Reset tilt if it exceeds 40 degrees
                    //     map.setTilt(newTilt);
                    //     break;
                }

                // Update map position
                map.setPosition({ latitude: position.latitude, longitude: position.longitude });
                
                requestAnimationFrame(smoothTransition); // Continue the smooth transition
            }

            document.addEventListener('keydown', function(e) {
                switch (e.key) {
                    case 'ArrowUp': // Move north
                    case 'w':
                        isMoving = true;
                        currentMovement = 'moveNorth';
                        smoothTransition();
                        break;
                    case 'ArrowDown': // Move south
                    case 's':
                        isMoving = true;
                        currentMovement = 'moveSouth';
                        smoothTransition();
                        break;
                    case 'ArrowLeft': // Move west
                    case 'a':
                        isMoving = true;
                        currentMovement = 'moveWest';
                        smoothTransition();
                        break;
                    case 'ArrowRight': // Move east
                    case 'd':
                        isMoving = true;
                        currentMovement = 'moveEast';
                        smoothTransition();
                        break;
                    case 'j': // Rotate clockwise
                        isMoving = true;
                        currentMovement = 'rotateRight';
                        smoothTransition();
                        break;
                    case 'l': // Rotate counterclockwise
                        isMoving = true;
                        currentMovement = 'rotateLeft';
                        smoothTransition();
                        break;
                    case 'q': // Zoom in
                        isMoving = true;
                        currentMovement = 'zoomIn';
                        smoothTransition();
                        break;
                    case 'r': // Zoom out
                        isMoving = true;
                        currentMovement = 'zoomOut';
                        smoothTransition();
                        break;
                    case 't': // Tilt
                        isMoving = true;
                        let newTilt = map.getTilt() + tiltSpeed;
                        if (newTilt > 40) newTilt = 0; // Reset tilt if it exceeds 40 degrees
                        map.setTilt(newTilt);
                        break;
                }
            });

            document.addEventListener('keyup', function() {
                isMoving = false; // Stop movement when key is released
            });

            
        </script>
    </body>
</html>
