<html>
    <head>
        <link href="https://cdn.osmbuildings.org/4.0.0/OSMBuildings.css" rel="stylesheet">
        <script src="https://cdn.osmbuildings.org/4.0.0/OSMBuildings.js"></script>
    </head>
    <body>
        <div id="map" style="width: 100vw; height: 100vh;"></div>

        <script src="https://rawgit.com/OSMBuildings/OSMBuildings/master/dist/OSMBuildings/OSMBuildings.js"></script> 
        
        <script>
            var map = new OSMBuildings({
                container: 'map',
                position: { latitude: 52.52128, longitude: 13.40894 }, // Starting position
                zoom: 16,
                minZoom: 15,
                maxZoom: 20,
                tilt: 40, 
                rotation:300,
                effects: ['shadows'],
                attribution: '© Data <a href="https://openstreetmap.org/copyright/">OpenStreetMap</a> © Map <a href="https://mapbox.com/">Mapbox</a> © 3D <a href="https://osmbuildings.org/copyright/">OSM Buildings</a>'
            });

            map.addMapTiles('https://tile-a.openstreetmap.fr/hot/{z}/{x}/{y}.png');
            map.addGeoJSONTiles('https://{s}.data.osmbuildings.org/0.2/59fcc2e8/tile/{z}/{x}/{y}.json');

            let rotationSpeed = 5;  // Speed of rotation (degrees per key press)
            let position = { latitude: 52.52128, longitude: 13.40894 }; // Store current position
            let movementSpeed = 0.0005; // Movement speed for each key press

            // Key handling for movement and rotation
            document.addEventListener('keydown', function(e) {
                switch (e.key) {
                    case 'ArrowUp': // Up arrow or 'W'
                    case 'w':
                        position.latitude += movementSpeed; // Move north
                        break;
                    case 'ArrowDown': // Down arrow or 'S'
                    case 's':
                        position.latitude -= movementSpeed; // Move south
                        break;
                    case 'ArrowLeft': // Left arrow or 'A'
                    case 'a':
                        position.longitude -= movementSpeed; // Move west
                        break;
                    case 'ArrowRight': // Right arrow or 'D'
                    case 'd':
                        position.longitude += movementSpeed; // Move east
                        break;
                    case 'r': // Rotate right
                        map.setRotation(map.getRotation() + rotationSpeed);
                        break;
                    case 'l': // Rotate left
                        map.setRotation(map.getRotation() - rotationSpeed);
                        break;
                    case 't': // Toggle tilt
                        let newTilt = map.getTilt() + 10;
                        if (newTilt > 40) newTilt = 0; // Reset tilt if it exceeds 40 degrees
                        map.setTilt(newTilt);
                        break;
                    case 'z': // Zoom in
                        map.setZoom(map.getZoom() + 1);
                        break;
                    case 'x': // Zoom out
                        map.setZoom(map.getZoom() - 1);
                        break;
                }

                // Update map position
                map.setPosition({ latitude: position.latitude, longitude: position.longitude });
            });
        </script>
    </body>
</html>
